# Cuckoo Sandbox Dockerfile for PE File Analysis
FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    python3=3.8.* python3-pip=20.0.* python3-dev libffi-dev libssl-dev libcap2-bin curl libxml2-dev nano \
    libxslt1-dev libjpeg-dev zlib1g-dev mongodb postgresql libpq-dev tcpdump apparmor-utils yara libfuzzy-dev ssdeep \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

RUN pip3 install --no-cache-dir cuckoo==2.0.7 celery==5.2.7 redis==4.3.4 requests==2.28.1 \
    volatility3==2.4.1 ssdeep==3.4 pefile==2023.2.7 python-dotenv==1.0.0 watchdog==3.0.0

RUN setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

RUN useradd -m -s /bin/bash cuckoo

RUN mkdir -p /dataset /config && chown -R cuckoo:cuckoo /dataset /config

USER cuckoo
WORKDIR /home/cuckoo

RUN cuckoo init

COPY --chown=cuckoo:cuckoo report_sender.py /home/cuckoo/report_sender.py
COPY --chown=cuckoo:cuckoo .env /home/cuckoo/.env

VOLUME ["/dataset"]

CMD ["/bin/bash"]