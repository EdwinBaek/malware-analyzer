import os
from dotenv import load_dotenv
from src import static_analysis, cuckoo_parser, dataset_processing, file_utils

# .env 파일 로드
load_dotenv(dotenv_path='.env')


if __name__ == "__main__":
    job = os.getenv('JOB')
    print(f"{job} start!")

    # Static analysis and parsing CSV file
    if job == 'STATIC_ANALYSIS':
        static_analysis.main(os.getenv('TEST_RAW_DIR'), os.getenv('TEST_STATIC_FEATURE_DIR'))
        # static_analysis.main(os.getenv('KISA_RAW_DIR'), os.getenv('KISA_STATIC_FEATURE_DIR'))
        # static_analysis.main(os.getenv('BODMAS_RAW_DIR'), os.getenv('BODMAS_STATIC_FEATURE_DIR'))
        # static_analysis.main(os.getenv('VS_RAW_DIR'), os.getenv('VS_STATIC_FEATURE_DIR'))

    # Cuckoo report parsing
    elif job == 'CUCKOO_REPORTS_PARSING':
        cuckoo_parser.main(os.getenv('TEST_CUCKOO_REPORTS_DIR'), os.getenv('TEST_DYNAMIC_FEATURE_DIR'))
        # cuckoo_parser.main(os.getenv('KISA_CUCKOO_REPORTS_DIR'), os.getenv('KISA_DYNAMIC_FEATURE_DIR'))
        # cuckoo_parser.main(os.getenv('BODMAS_CUCKOO_REPORTS_DIR'), os.getenv('BODMAS_DYNAMIC_FEATURE_DIR'))
        # cuckoo_parser.main(os.getenv('VS_CUCKOO_REPORTS_DIR'), os.getenv('VS_DYNAMIC_FEATURE_DIR'))

    # STATIC_ANALYSIS, CUCKOO_REPORTS_PARSING을 통해 추출된 feature 중 전처리함
    elif job == 'PROCESSING_DATASET':
        dataset_processing.main(
            os.getenv('TEST_DYNAMIC_FEATURE_DIR'),
            os.getenv('TEST_STATIC_FEATURE_DIR'),
            os.getenv('TEST_PREPROCESSING_OUTPUT_DIR')
        )
        """
        # KISA dataset
        dataset_processing.main(
            os.getenv('KISA_DYNAMIC_FEATURE_DIR'),
            os.getenv('KISA_STATIC_FEATURE_DIR'),
            os.getenv('KISA_PREPROCESSING_OUTPUT_DIR')
        )
        # BODMAS dataset
        dataset_processing.main(
            os.getenv('BODMAS_DYNAMIC_FEATURE_DIR'),
            os.getenv('BODMAS_STATIC_FEATURE_DIR'),
            os.getenv('BODMAS_PREPROCESSING_OUTPUT_DIR')
        )
        # VirusShare dataset
        dataset_processing.main(
            os.getenv('VS_DYNAMIC_FEATURE_DIR'),
            os.getenv('VS_STATIC_FEATURE_DIR'),
            os.getenv('VS_PREPROCESSING_OUTPUT_DIR')
        )
        """
    elif job == 'MOVE_REPORTS':
        file_utils.main()
    else:
        print("Select job...")